---
title: "A1"
output:
  html_document:
    toc: true
    
---
## Select an Expression Data Set 
Download required package
```{r, eval=FALSE}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
    
if (!requireNamespace("GEOmetadb", quietly = TRUE))
    BiocManager::install("GEOmetadb")
```
\
get GEO metadata
```{r, eval=FALSE}
if(!file.exists('GEOmetadb.sqlite')) GEOmetadb::getSQLiteFile()
```  
\
Assign metadata to variable "con"
```{r, eval=FALSE}
con <- DBI::dbConnect(RSQLite::SQLite(),'GEOmetadb.sqlite')
```
\
Check if we have the sqlite file installed properly by checking the table of 
the GEO Database 
```{r, eval=FALSE}
geo_tables <- DBI::dbListTables(con)
geo_tables
results <- DBI::dbGetQuery(con,'select * from gse limit 5')
```
\
The data I want is Alzheimer disease data from human, RNAseq, 
no earlier than 2013.\
Use paste to combine the strings used for searching in SQL.
```{r, eval=FALSE}
sql <- paste("SELECT DISTINCT gse.title,gse.gse, gpl.title,",
             " gse.submission_date,",
             " gse.supplementary_file",
             "FROM",
             "  gse JOIN gse_gpl ON gse_gpl.gse=gse.gse",
             "  JOIN gpl ON gse_gpl.gpl=gpl.gpl",
             "WHERE",
             "  gse.submission_date > '2013-01-01' AND",
             "  gse.title LIKE '%Alzheimer%' AND", 
             "  gpl.organism LIKE '%Homo sapiens%' AND",
             "  gpl.technology LIKE '%high-throughput sequencing%' ",
             "  ORDER BY gse.submission_date DESC",sep=" ")
```
\
Search desired data set in the database, and assign it to varible rs
```{r, eval=FALSE}
rs <- DBI::dbGetQuery(con, sql)

knitr::kable(rs, format = "pipe")
```
\
get samples that have counts data.
```{r, eval=FALSE}
counts_files <- rs$supplementary_file[grep(rs$supplementary_file,
                              pattern = "count",ignore.case = TRUE)]
knitr::kable(counts_files, format = "pipe")
```
\
GSE102956 data set looks good with counts number\
Get the supplementary files of GSE102956 from GEO by getGEOSuppFiles function
```{r, eval=FALSE}
sfiles = GEOquery::getGEOSuppFiles('GSE102956')
fnames = rownames(sfiles)
#There are 4 files 
```
\
Check its data. 
```{r, eval=FALSE}
b2 = read.delim(fnames[2],header=TRUE)
head(b2)
```


